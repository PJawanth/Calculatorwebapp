<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevOps Metrics Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e0e0e0;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
        }

        header h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #00d9ff, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        header p {
            color: #888;
            font-size: 1rem;
        }

        .meta-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
            font-size: 0.9rem;
            color: #666;
        }

        .section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #00d9ff;
            border-bottom: 2px solid #00d9ff;
            padding-bottom: 10px;
        }

        .cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 40px rgba(0, 217, 255, 0.2);
        }

        .card-title {
            font-size: 0.9rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .card-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .card-value.success { color: #00ff88; }
        .card-value.warning { color: #ffcc00; }
        .card-value.danger { color: #ff4757; }
        .card-value.info { color: #00d9ff; }

        .card-subtitle {
            font-size: 0.85rem;
            color: #666;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-badge.success { background: rgba(0, 255, 136, 0.2); color: #00ff88; }
        .status-badge.failure { background: rgba(255, 71, 87, 0.2); color: #ff4757; }
        .status-badge.unknown { background: rgba(136, 136, 136, 0.2); color: #888; }

        .loading {
            text-align: center;
            padding: 60px;
            font-size: 1.2rem;
            color: #666;
        }

        .error {
            text-align: center;
            padding: 60px;
            color: #ff4757;
        }

        footer {
            text-align: center;
            margin-top: 60px;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            header h1 { font-size: 1.8rem; }
            .card-value { font-size: 2rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä DevOps Metrics Dashboard</h1>
            <p>DevOps + DevSecOps + Dependency Health Metrics</p>
            <div class="meta-info" id="meta-info"></div>
        </header>

        <div id="dashboard-content">
            <div class="loading">Loading metrics...</div>
        </div>

        <footer>
            <p>Auto-generated by GitHub Actions | Data refreshed every 6 hours</p>
        </footer>
    </div>

    <script>
        async function loadMetrics() {
            const content = document.getElementById('dashboard-content');

            try {
                const [metricsResponse, dependencyResponse] = await Promise.all([
                    fetch('metrics.json'),
                    fetch('dependency.json').catch(() => ({ ok: false }))
                ]);

                if (!metricsResponse.ok) {
                    throw new Error('Failed to load metrics');
                }

                const metrics = await metricsResponse.json();
                const dependency = dependencyResponse.ok ? await dependencyResponse.json() : { outdated_count: 'N/A' };

                renderDashboard(metrics, dependency);
            } catch (error) {
                content.innerHTML = `<div class="error">Error loading metrics: ${error.message}</div>`;
            }
        }

        function renderDashboard(metrics, dependency) {
            const content = document.getElementById('dashboard-content');
            const metaInfo = document.getElementById('meta-info');

            // Meta info
            const generatedAt = new Date(metrics.generated_at).toLocaleString();
            metaInfo.innerHTML = `
                <span>üìÖ Last Updated: ${generatedAt}</span>
                <span>üì¶ Repository: ${metrics.repository}</span>
                <span>‚è±Ô∏è Window: ${metrics.window_days} days</span>
            `;

            // Build dashboard HTML
            content.innerHTML = `
                <!-- DORA Metrics -->
                <section class="section">
                    <h2 class="section-title">üöÄ DORA Metrics</h2>
                    <div class="cards">
                        <div class="card">
                            <div class="card-title">Deployments Total</div>
                            <div class="card-value info">${metrics.dora.deployments_total}</div>
                            <div class="card-subtitle">In last ${metrics.window_days} days</div>
                        </div>
                        <div class="card">
                            <div class="card-title">Successful Deploys</div>
                            <div class="card-value success">${metrics.dora.deployments_successful}</div>
                        </div>
                        <div class="card">
                            <div class="card-title">Failed Deploys</div>
                            <div class="card-value ${metrics.dora.deployments_failed > 0 ? 'danger' : 'success'}">${metrics.dora.deployments_failed}</div>
                        </div>
                        <div class="card">
                            <div class="card-title">Change Failure Rate</div>
                            <div class="card-value ${getFailureRateClass(metrics.dora.change_failure_rate_percent)}">${metrics.dora.change_failure_rate_percent}%</div>
                            <div class="card-subtitle">Target: &lt; 15%</div>
                        </div>
                        <div class="card">
                            <div class="card-title">MTTR (Proxy)</div>
                            <div class="card-value info">${metrics.dora.mttr_hours ?? 'N/A'}</div>
                            <div class="card-subtitle">Hours to recovery</div>
                        </div>
                    </div>
                </section>

                <!-- PR & Flow Metrics -->
                <section class="section">
                    <h2 class="section-title">üîÑ Pull Request Metrics</h2>
                    <div class="cards">
                        <div class="card">
                            <div class="card-title">PR Throughput</div>
                            <div class="card-value info">${metrics.pull_requests.pr_throughput}</div>
                            <div class="card-subtitle">Merged PRs in window</div>
                        </div>
                        <div class="card">
                            <div class="card-title">Avg Lead Time</div>
                            <div class="card-value info">${metrics.pull_requests.pr_lead_time_avg_hours ?? 'N/A'}</div>
                            <div class="card-subtitle">Hours (created ‚Üí merged)</div>
                        </div>
                        <div class="card">
                            <div class="card-title">Median Lead Time</div>
                            <div class="card-value info">${metrics.pull_requests.pr_lead_time_median_hours ?? 'N/A'}</div>
                            <div class="card-subtitle">Hours (created ‚Üí merged)</div>
                        </div>
                    </div>
                </section>

                <!-- CI Health -->
                <section class="section">
                    <h2 class="section-title">‚öôÔ∏è CI/CD Health</h2>
                    <div class="cards">
                        <div class="card">
                            <div class="card-title">CI Runs</div>
                            <div class="card-value info">${metrics.ci_health.ci_runs_total}</div>
                        </div>
                        <div class="card">
                            <div class="card-title">CI Success Rate</div>
                            <div class="card-value ${getCISuccessClass(metrics.ci_health.ci_success_rate_percent)}">${metrics.ci_health.ci_success_rate_percent}%</div>
                            <div class="card-subtitle">Target: &gt; 90%</div>
                        </div>
                        <div class="card">
                            <div class="card-title">Avg CI Duration</div>
                            <div class="card-value info">${metrics.ci_health.ci_avg_duration_minutes ?? 'N/A'}</div>
                            <div class="card-subtitle">Minutes</div>
                        </div>
                        <div class="card">
                            <div class="card-title">Avg Deploy Duration</div>
                            <div class="card-value info">${metrics.deploy_health.deploy_avg_duration_minutes ?? 'N/A'}</div>
                            <div class="card-subtitle">Minutes</div>
                        </div>
                    </div>
                </section>

                <!-- Security Metrics -->
                <section class="section">
                    <h2 class="section-title">üîí DevSecOps Metrics</h2>
                    <div class="cards">
                        <div class="card">
                            <div class="card-title">Security Scans</div>
                            <div class="card-value info">${metrics.security.security_runs_total}</div>
                        </div>
                        <div class="card">
                            <div class="card-title">Security Success Rate</div>
                            <div class="card-value ${getCISuccessClass(metrics.security.security_success_rate_percent)}">${metrics.security.security_success_rate_percent}%</div>
                        </div>
                        <div class="card">
                            <div class="card-title">Last Scan Status</div>
                            <div class="card-value">
                                <span class="status-badge ${getStatusClass(metrics.security.security_last_conclusion)}">
                                    ${metrics.security.security_last_conclusion ?? 'N/A'}
                                </span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Dependency Metrics -->
                <section class="section">
                    <h2 class="section-title">üì¶ Dependency Health</h2>
                    <div class="cards">
                        <div class="card">
                            <div class="card-title">Dependabot PRs Open</div>
                            <div class="card-value ${metrics.dependabot.dependabot_prs_open > 5 ? 'warning' : 'info'}">${metrics.dependabot.dependabot_prs_open}</div>
                        </div>
                        <div class="card">
                            <div class="card-title">Dependabot PRs Merged</div>
                            <div class="card-value success">${metrics.dependabot.dependabot_prs_merged}</div>
                            <div class="card-subtitle">In window</div>
                        </div>
                        <div class="card">
                            <div class="card-title">Outdated Dependencies</div>
                            <div class="card-value ${getOutdatedClass(dependency.outdated_count)}">${dependency.outdated_count}</div>
                            <div class="card-subtitle">pip list --outdated</div>
                        </div>
                    </div>
                </section>
            `;
        }

        function getFailureRateClass(rate) {
            if (rate < 15) return 'success';
            if (rate < 30) return 'warning';
            return 'danger';
        }

        function getCISuccessClass(rate) {
            if (rate >= 90) return 'success';
            if (rate >= 70) return 'warning';
            return 'danger';
        }

        function getStatusClass(status) {
            if (status === 'success') return 'success';
            if (status === 'failure') return 'failure';
            return 'unknown';
        }

        function getOutdatedClass(count) {
            if (count === 'N/A') return 'info';
            if (count <= 3) return 'success';
            if (count <= 10) return 'warning';
            return 'danger';
        }

        // Load metrics on page load
        loadMetrics();
    </script>
</body>
</html>
